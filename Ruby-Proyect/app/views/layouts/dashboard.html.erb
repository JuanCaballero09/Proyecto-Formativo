<!DOCTYPE html>
<html>
<head>
  <title>Panel De Administrador</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
  <%= action_cable_meta_tag %>

  <link rel="icon" href="<%= asset_path('LogoLogo.svg') %>" type="image/svg+xml">
  <link rel="apple-touch-icon" href="<%= asset_path('LogoLogo.svg') %>" type="image/svg+xml">
  
  <%= stylesheet_link_tag "bootstrap.min", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "dashboard", "data-turbo-track": "reload" %>

</head>
<body>
  <main class="dashboard-container" style="display: flex;">
  
    <aside class="sidebar">

      <div class="session-header" style="margin: 15px 0; ">
        <%= image_tag "LogoLogo.svg", alt: "logo", style: "margin:0; height: 130px; width:130px;"%>
      </div>

      <h2>Panel</h2>

      <% if current_user.empleado? %>

        <p>Bienvenido, <%= current_user.nombre %>!</p>

        <%= link_to "Órdenes", employee_dashboard_orders_path %>
      
      <% elsif current_user.admin? %>
      
        <p>Bienvenido, <%= current_user.nombre %>!</p>

        <%= link_to t("home.dashboard.dash"), dashboard_root_path %>
        <%= link_to "Usuarios", dashboard_users_path %>
        <%= link_to "Órdenes", dashboard_orders_path %>
        
        <details>
          <summary><%= t("home.dashboard.banner")%></summary>
            <div class="details-content">
              <%= link_to t("home.dashboard.ver_banners"), dashboard_banners_path%>
              <%= link_to t("home.dashboard.crear_banner"), new_dashboard_banner_path%>
            </div>
        </details>

        <details>
          <summary><%= t("home.dashboard.cupones")%></summary>
            <div class="details-content">
              <%= link_to t("home.dashboard.ver_cupones"), dashboard_coupons_path %>
              <%= link_to t("home.dashboard.crear_cupon"), new_dashboard_coupon_path %>
            </div>
        </details>

        <details>
          <summary><%= t("home.dashboard.producto")%></summary>
            <div class="details-content">
              <%= link_to t("home.dashboard.ver_productos"), dashboard_products_path %>
              <%= link_to t("home.dashboard.crear_producto"), new_dashboard_product_path %>
            </div>
        </details>

        <details>
          <summary><%= t("home.dashboard.grupos")%></summary>
            <div class="details-content">
              <%= link_to t("home.dashboard.ver_grupos"), dashboard_grupos_path %>
              <%= link_to t("home.dashboard.crear_grupo"), new_dashboard_grupo_path %>
            </div>
        </details>

        <details>
          <summary><%= t("home.dashboard.ingredientes")%></summary>
            <div class="details-content">
              <%= link_to t("home.dashboard.ver_ingredientes"), dashboard_ingredientes_path %>
              <%= link_to t("home.dashboard.crear_ingrediente"), new_dashboard_ingrediente_path %>
            </div>
        </details>

      <% end %>

      
      <%= link_to t("home.dashboard.volver_al_inicio"), root_path, class: "sidebar-footer"%>
      
    </aside>


    <section class="main-content">

      <!-- Contenedor de alertas -->
      <div id="alert-container">
        <% flash.each do |key, message| %>
          <% css_class = case key.to_sym
            when :notice then "success"
            when :alert  then "error"
            when :error  then "error"
            when :success then "success"
            else "info"
          end %>
          <div class="alert <%= css_class %>"><%= message %></div>
        <% end %>

        <!-- Contenedor vacío para toasts dinámicos -->
        <div id="flash-toast"></div>
      </div>


      <%= yield %>
      
    </section>

  </main>
  <div id="animations"></div>
  <script>
  document.addEventListener("turbo:load", () => {
    const showAlert = (alertElement) => {
      // Mostrar inmediatamente
      alertElement.style.opacity = '1';
      alertElement.style.animation = "alertSlideIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards";
      
      // Ocultar después de 3 segundos
      setTimeout(() => {
        alertElement.style.animation = "alertSlideOut 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards";
        
        // Remover completamente después de la animación
        setTimeout(() => {
          if (alertElement.parentNode) {
            alertElement.remove();
          }
        }, 500); // 500ms = duración de alertSlideOut
      }, 3000);
    };

    // Animar alertas que ya existían
    document.querySelectorAll("#alert-container .alert").forEach(showAlert);

    // Observar cambios en el contenedor para nuevas alertas
    const alertContainer = document.getElementById("alert-container");
    if (alertContainer) {
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1 && node.classList.contains("alert")) {
              showAlert(node);
            }
          });
        });
      });
      observer.observe(alertContainer, { childList: true, subtree: true });
    }

    // Función global para crear alertas dinámicas
    window.showFlashAlert = function(message, type = 'success') {
      const container = document.getElementById('flash-toast');
      if (!container) return;

      const alert = document.createElement('div');
      alert.className = `alert ${type}`;
      alert.textContent = message;
      container.appendChild(alert);
      showAlert(alert);
    };
  });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
