<div class="order-details-premium">
  <!-- Header de la orden -->
  <div class="order-header">
    <div class="order-header-content">
      <div class="back-button-container">
        <%= link_to root_path, class: "back-button-premium" do %>
          <i class="back-icon">‚Üê</i>
          <span><%= t("home.order.regresar")%></span>
        <% end %>
      </div>
      
      <div class="order-title-section">
        <h1 class="order-title">
          <i class="order-icon">üìã</i>
          <%= t("home.order.detalles")%>
        </h1>
        
        <div class="order-code-container">
          <span class="code-label"><%= t("home.order.codigo")%></span>
          <span class="order-code" id="order-code"><%= @order.code %></span>
          <button class="copy-button" onclick="copyOrderCode()" title="Copiar c√≥digo">
            <%= image_tag "icons/copy-solid-full.svg", class: "copy-icon" %>
          </button>
        </div>        
      </div>
    </div>
  </div>

  <!-- Informaci√≥n del cliente y estado -->
  <div class="order-content-grid">
    <!-- Columna izquierda: Informaci√≥n de la orden -->
    <div class="order-left-column">
      <div class="order-info-section">
        <h2 class="info-section-title">
          <i class="info-section-icon">‚ÑπÔ∏è</i>
          <%= t("home.order.informacion_orden")%>
        </h2>
        
        <div class="info-cards-vertical">
          <div class="info-card customer-info">
            <div class="info-header">
              <i class="info-icon">üë§</i>
              <h3><%= t("home.order.cliente") %></h3>
            </div>
            <p class="customer-name"><%= @order.customer_name %></p>
          </div>
          
          <div class="info-card status-info">
            <div class="info-header">
              <i class="info-icon">üìä</i>
              <h3><%= t("home.order.estado") %></h3>
            </div>
            <span class="order-status status-<%= @order.status.downcase.gsub(' ', '-') %>">
              <%= @order.status %>
            </span>
          </div>
          
          <div class="info-card status-info">
            <div class="info-header">
              <i class="info-icon">üè†</i>
              <h3><%= t("home.order.direccion") %></h3>
            </div>
            <span class="order-status status-<%= @order.direccion.downcase.gsub(' ', '-') %>">
              <%= @order.direccion %>
            </span>
          </div>
          
          
          <% if @order.coupon.present? %>
            <div class="info-card coupon-info">
              <div class="info-header">
                <i class="info-icon">üè∑Ô∏è</i>
                <h3>Cup√≥n Aplicado</h3>
              </div>
              <p class="coupon-code"><%= @order.coupon.codigo %></p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Total de la orden -->
      <div class="order-total-section">
        <div class="total-card">
          <div class="total-header">
            <h3 class="total-title">
              <i class="total-icon">üí∞</i>
              <%= t("home.order.tootal_paga") %>
            </h3>
          </div>
          
          <div class="total-amount">
             <strong class="precio-unitario" data-precio="<%= @order.total %>" data-locale="<%= I18n.locale %>">$</strong>
          </div>
          
          <% if @order.coupon.present? %>
            <div class="discount-info">
              <i class="discount-icon">üè∑Ô∏è</i>
              <span>Descuento aplicado con cup√≥n <%= @order.coupon.codigo %></span>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Bot√≥n de pago -->
      <div class="payment-section">
        <%= link_to new_order_payments_path(@order), class: "payment-button" do %>
          <i class="payment-icon">üí≥</i>
          <span><%= t("home.order.pagar")%></span>
          <i class="payment-arrow">‚Üí</i>
        <% end %>
      </div>
    </div>

    <!-- Columna derecha: Productos de la orden -->
    <div class="order-right-column">
      <div class="products-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="section-icon">üçΩÔ∏è</i>
            <%= t("home.order.or_producto") %>
          </h2>
          <span class="items-count"><%= @order.order_items.count %> <%= t("home.ordenes.producto")%> <%= @order.order_items.count != 1 ? 's' : '' %></span>
        </div>
        
        <div class="products-container">
          <% @order.order_items.each_with_index do |order_item, index| %>
            <div class="product-item <%= 'is-combo' if order_item.product.is_a?(Combo) %>">
              <div class="product-main-info">
                <div class="product-image-container">
                  <% if order_item.product.imagen.attached? %>
                    <%= image_tag order_item.product.imagen, alt: order_item.product.nombre, class: "product-image" %>
                  <% else %>
                    <%= image_tag 'LogoLogo.svg', alt: order_item.product.nombre, class: "product-image placeholder" %>
                  <% end %>
                  
                  <% if order_item.product.is_a?(Combo) %>
                    <div class="combo-badge">
                      <span>COMBO</span>
                    </div>
                  <% end %>
                </div>
                
                <div class="product-details">
                  <div class="product-header">
                    <h3 class="product-name"><%= order_item.product.nombre %></h3>
                    <div class="product-meta">
                      <span class="product-category"><%= order_item.product.grupo.nombre %></span>
                    </div>
                  </div>
                  
                  <div class="quantity-price-info">
                    <div class="quantity-container">
                      <span class="quantity-label">Cantidad:</span>
                      <span class="quantity-value"><%= order_item.quantity %></span>
                    </div>
                    
                    <div class="price-container">
                      <div class="unit-price">
                        <span class="price-label">Precio unitario:</span>
                        <span class="price-value">
                        <strong class="precio-unitario" data-precio="<%= order_item.price %>" data-locale="<%= I18n.locale %>">$</strong>
                        </span>
                      </div>
                      
                      <div class="total-price">
                        <span class="price-label">Subtotal:</span>
                        <span class="price-value total">
                          <% total_item = order_item.price * order_item.quantity %>
                          <strong class="precio-total"
                            data-precio="<%= total_item %>"
                            data-locale="<%= I18n.locale %>">
                            <% if I18n.locale == :en %>
                              <%= number_to_currency(total_item / 4000, unit: "USD", format: "%n %u", precision: 2) %>
                            <% else %>
                              <%= number_to_currency(total_item, unit: "COP", format: "%n %u", precision: 2) %>
                            <% end %>
                          </strong>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Componentes del combo -->
              <% if order_item.product.is_a?(Combo) && order_item.product.combo_items.any? %>
                <div class="combo-components">
                  <div class="combo-header">
                    <h4 class="combo-title">
                      <i class="combo-icon">üì¶</i>
                      Componentes del combo:
                    </h4>
                    <button class="toggle-combo" onclick="toggleComboDetails(<%= index %>)">
                      <span class="toggle-text">Ver componentes</span>
                      <i class="toggle-arrow">‚ñº</i>
                    </button>
                  </div>
                  
                  <div class="combo-details" id="combo-details-<%= index %>" style="display: none;">
                    <div class="combo-items-grid">
                      <% order_item.product.combo_items.each do |combo_item| %>
                        <div class="combo-item">
                          <div class="combo-item-image">
                            <% if combo_item.product.imagen.attached? %>
                              <%= image_tag combo_item.product.imagen, alt: combo_item.product.nombre, class: "combo-product-image" %>
                            <% else %>
                              <%= image_tag 'LogoLogo.svg', alt: combo_item.product.nombre, class: "combo-product-image placeholder" %>
                            <% end %>
                          </div>
                          
                          <div class="combo-item-info">
                            <h5 class="combo-item-name"><%= combo_item.product.nombre %></h5>
                            <div class="combo-item-quantity">
                              <span class="quantity-badge"><%= combo_item.cantidad %>x</span>
                            </div>
                            <p class="combo-item-description">
                              <%= combo_item.product.descripcion.present? ? truncate(combo_item.product.descripcion, length: 80) : "Componente del combo" %>
                            </p>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function copyOrderCode() {
    const codigo = document.getElementById('order-code').innerText;
    navigator.clipboard.writeText(codigo).then(() => {
        // Usar el sistema de alertas premium
        if (window.createFlashAlert) {
            window.createFlashAlert(`C√≥digo copiado: ${codigo}`, 'success', 3000);
        } else {
            alert("C√≥digo copiado: " + codigo);
        }
    }).catch(err => {
        console.error("Error al copiar: ", err);
        if (window.createFlashAlert) {
            window.createFlashAlert('Error al copiar el c√≥digo', 'error', 3000);
        } else {
            alert("Error al copiar el c√≥digo");
        }
    });
}

function toggleComboDetails(index) {
    const details = document.getElementById(`combo-details-${index}`);
    const button = details.previousElementSibling.querySelector('.toggle-combo');
    const arrow = button.querySelector('.toggle-arrow');
    const text = button.querySelector('.toggle-text');
    
    if (details.style.display === 'none') {
        details.style.display = 'block';
        arrow.style.transform = 'rotate(180deg)';
        text.textContent = 'Ocultar componentes';
        
        // Animaci√≥n de aparici√≥n
        details.style.opacity = '0';
        details.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            details.style.transition = 'all 0.3s ease';
            details.style.opacity = '1';
            details.style.transform = 'translateY(0)';
        }, 10);
    } else {
        details.style.transition = 'all 0.3s ease';
        details.style.opacity = '0';
        details.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
            details.style.display = 'none';
            arrow.style.transform = 'rotate(0deg)';
            text.textContent = 'Ver componentes';
        }, 300);
    }
}

// Inicializar efectos al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    // Animaci√≥n de entrada para las tarjetas de productos
    const productItems = document.querySelectorAll('.product-item');
    productItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            item.style.transition = 'all 0.5s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>