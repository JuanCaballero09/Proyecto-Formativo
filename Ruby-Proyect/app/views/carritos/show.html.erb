<section class="carrito-modern">
  <div class="carrito-container">
    <!-- Header del carrito -->
    <div class="carrito-header">
      <div class="header-content">
        <div class="header-icon">ðŸ›’</div>
        <div class="header-info">
          <h1 class="carrito-titulo"><%= t("home.carrito.tu_carrito")%></h1>
          <% unless @items.empty? %>
            <p class="carrito-subtitulo">
              <span class="item-count"><%= @carrito.carrito_items.sum(:cantidad) %></span> 
              <%= @carrito.carrito_items.sum(:cantidad) == 1 ? "producto" : t("home.carrito.productos_carritos") %> 
            </p>
          <% end %>
        </div>
      </div>
    </div>

    <% if @items.empty? %>
      <!-- Carrito vacÃ­o -->
      <div class="carrito-vacio">
        <div class="vacio-icon">ðŸ›’</div>
        <h3 class="vacio-titulo"><%= t("home.carrito.carrito_vacio")%></h3>
        <p class="vacio-descripcion"><%= t("home.carrito.agrega_producto")%></p>
        <%= link_to t("home.carrito.explorar_productos"), products_path, class: "btn-explorar" %>
      </div>
    <% else %>
      <div class="carrito-content">
        <!-- Items del carrito -->
        <div class="carrito-items-section">
          <div class="items-header">
            <h3 class="items-titulo"><%= t("home.carrito.producto_selecionado")%></h3>
            <div class="items-contador">
              <span id="contador-productos"><%= @carrito.carrito_items.sum(:cantidad) %></span>
              <%= @carrito.carrito_items.sum(:cantidad) == 1 ? "item" : "items" %>
            </div>
          </div>
          
          <%= turbo_frame_tag "carrito", class: "carrito-items-list" do %>
            <%= render partial: "carritos/item",
                       collection: @carrito.carrito_items,
                       as: :item %>
          <% end %>
        </div>

        <!-- Sidebar con totales y acciones -->
        <div class="carrito-sidebar">
          <!-- CupÃ³n -->
          <div class="cupon-section">
            <%= turbo_frame_tag "carrito-cupon" do %>
              <%= render "carritos/cupon", carrito: @carrito %>
            <% end %>
          </div>

          <!-- Totales -->
          <div class="totales-section">
            <div class="totales-card">
              <h3 class="totales-titulo"><%= t("home.carrito.resumen_pedido")%></h3>
              
              <div id="totales-carrito" class="totales-detalle">
                <div class="total-item">
                  <span class="total-label">Subtotal:</span>
                  <span class="total-value">
                    <strong class="precio-total"
                        data-precio="<%= @carrito.subtotal %>"
                        data-locale="<%= I18n.locale %>">
                        <% if I18n.locale == :en %>
                          <%= number_to_currency(@carrito.subtotal/ 4000, unit: "USD", format: "%n %u", precision: 2) %>
                        <% else %>
                          <%= number_to_currency(@carrito.subtotal, unit: "COP", separator: ",", delimiter: ".", format: "%n %u", precision: 2) %>
                        <% end %>
                      </strong>
                    </span>
                </div>
                
                <% if @carrito.descuento > 0 %>
                  <div class="total-item descuento">
                    <span class="total-label"><%= t("home.carrito.descuento")%></span>
                    <span class="total-value">
                      -<strong class="precio-unitario" 
                        data-precio= "<%= @carrito.descuento %>"
                        data-locale="<%= I18n.locale %>">
                        <% if I18n.locale == :en %>
                          <%= number_to_currency(@carrito.descuento/4000, unit: "USD",  format:"%n %u", precision: 2)%>
                        <% else %>
                          <%= number_to_currency(@carrito.descuento, unit:"COP", separator: ",", delimiter: ".", format:"%n %u", precision: 2)%>
                        <% end %>  
                      </strong>
                    </span>
                  </div>
                <% end %>
                
                <div class="total-item total-final">
                  <span class="total-label">Total:</span>
                  <span class= "total-value">
                      <strong class="precio-total"
                        data-precio="<%= @carrito.total %>"
                        data-locale="<%= I18n.locale %>">
                        <% if I18n.locale == :en %>
                          <%= number_to_currency(@carrito.total/ 4000, unit: "USD", format: "%n %u", precision: 2) %>
                        <% else %>
                          <%= number_to_currency(@carrito.total, unit: "COP", separator: ",", delimiter: ".", format: "%n %u", precision: 2) %>
                        <% end %>
                    </strong>
                  </span>
                </div>
              </div>


              <!-- BotÃ³n de compra -->
              <div class="checkout-section">
                <%= button_to t("home.show-vista.generar_orden"),
                              orders_path,
                              method: :post,
                              class: "btn-checkout" %>
                <p class="checkout-info">
                  <span class="info-icon">ðŸ”’</span>
                  <%= t("home.carrito.pago_protegido")%>
                </p>
              </div>
            </div>
          </div>

          <!-- InformaciÃ³n adicional -->
          <div class="info-adicional">
            <div class="info-item">
              <span class="info-icon">ðŸšš</span>
              <div class="info-content">
                <h4><%= t("home.carrito.entrega")%></h4>
                <p><%= t("home.carrito.recibe")%></p>
              </div>
            </div>
            <div class="info-item">
              <span class="info-icon">ðŸ’³</span>
              <div class="info-content">
                <h4><%= t("home.carrito.pagooo")%></h4>
                <p><%= t("home.carrito.multiple_metodo")%></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</section>
